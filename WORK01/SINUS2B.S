** RUTINAS DE SENOS & SPRITES
** NO ESTA ACABADO, TAN SOLO ES
** UNA PRUEBA. LAS TABLAS ESTAN
** GENERADAS CON EL GFA BASIC
** Y LAS CONVIERTO EN DIRECCIONES
** DE PANTALLA Y EN FUENTE DE SPR

** V. 2.3

** (C) 1990 RED DEVIL

MAXX	EQU (320-16-1)*8
MAXY	EQU (200-16)*8
BOLAS	EQU 41
SCREE1	EQU $F8000-$7D00
SCREE2	EQU $F8000

	BRA START 
MAKESPR	LEA PRO+34+(88*160),A0
	LEA SCREE2,A1
	BSR C_SP
	LEA PRO+34+((88+16)*160),A0
	LEA SCREE2+(17*160),A1
	BSR C_SP
	MOVEQ #16-1,D7
	LEA SPR_OR,A1
ROT_OR	BSR SAVE_SP
	LEA SCREE2,A0
	BSR ROX_OR
	LEA SCREE2+(17*160),A0
	BSR ROX_AND
	DBF D7,ROT_OR
	RTS
C_SP	MOVEQ #16-1,D7
CPSLOOP	MOVE.L (A0),(A1)
	MOVE.L 4(A0),4(A1)
	MOVE.L 8(A0),8(A1)
	MOVE.L 8+4(A0),8+4(A1)
	LEA 160(A0),A0
	LEA 160(A1),A1
	DBF D7,CPSLOOP
	RTS
SAVE_SP	LEA SCREE2,A0
	MOVEQ #16-1,D6
SVLOOP	MOVE.L 160*17(A0),(A1)+
	MOVE.L (A0),(A1)+
	MOVE.L (160*17)+8(A0),(A1)+
	MOVE.L 8(A0),(A1)+
	LEA 160(A0),A0
	DBF D6,SVLOOP
	RTS
ROX_OR	MOVEQ #16-1,D6
ROXLIN	MOVEQ #4-1,D5
ROXPLA	MOVE.W #0,CCR
	ROXR (A0)
	ROXR 8(A0)
	ADDQ.L #2,A0
	DBF D5,ROXPLA
	LEA 160-(4*2)(A0),A0
	DBF D6,ROXLIN
	RTS
ROX_AND	MOVEQ #16-1,D6
ROXLINA	MOVEQ #4-1,D5
ROXPLAA	MOVE.W #-1,CCR
	ROXR (A0)
	ROXR 8(A0)
	ADDQ.L #2,A0
	DBF D5,ROXPLAA
	LEA 160-(4*2)(A0),A0
	DBF D6,ROXLINA
	RTS
G_SINUS	LEA SINUS1,A0
	LEA SINUS2,A1
	LEA ESINUS1,A2
C_SINU	MOVE.L (A0)+,(A1)+
	CMPA.L A0,A2
	BGT.S C_SINU
	LEA SINUS1,A0
	MOVE.L #SCREE2,LOG_SC
	BSR GENEY
	LEA SINUS2,A0
	MOVE.L #SCREE1,LOG_SC
	BSR GENEY
	RTS
GENEY	MOVE.W #MAXX-1,D7
LOOPX	MOVEQ #0,D0
	MOVE.W (A0),D0
	MULU #160,D0
	MOVE.L D0,(A0)+
	MOVE.L #0,(A0)+
	DBF D7,LOOPX
	MOVE.W #MAXY-1,D7
GENEX	MOVEQ #0,D0
	MOVEQ #0,D1
	MOVE.W (A0),D0
	DIVU #16,D0
	MOVE.W D0,D1
	MULU #8,D1
	CLR.W D0
	SWAP D0
	MULU #2*4*16*2,D0
	ADD.L #SPR_OR,D0
	ADD.L LOG_SC,D1
	MOVE.L D0,(A0)+
	MOVE.L D1,(A0)+
	DBF D7,GENEX
	RTS
START	CLR.L -(A7)
	MOVE.W #$20,-(A7)
	TRAP #1
	LEA 6(A7),A7
	LEA $2000,A7
	BSR MAKESPR
	BSR G_SINUS
	BSR CLS
UJ	MOVE.W #$25,-(A7)
	TRAP #14
	LEA 2(A7),A7
	MOVEM.L PRO+2,D0-D7
	MOVEM.L D0-D7,$FFFF8240.W
	MOVE.L #SCREE2,D0
	LSR.L #8,D0
	MOVE.B D0,$FFFF8203.W
	LSR.W #8,D0
	MOVE.B D0,$FFFF8201.W
	BSR INPUT_K
	BSR BORRAB1
	BSR PUT_BS1
	MOVE.W #$25,-(A7)
	TRAP #14
	LEA 2(A7),A7
	MOVE.L #SCREE1,D0
	LSR.L #8,D0
	MOVE.B D0,$FFFF8203.W
	LSR.W #8,D0
	MOVE.B D0,$FFFF8201.W
	BSR INPUT_K
	BSR BORRAB2
	BSR PUT_BS2
	BRA.S UJ
	CLR.L -(A7)
	TRAP #1
INPUT_K	MOVE.B $FFFFFC02.W,D0
	SUBQ.B #2,D0
	BNE.S INCXX
	ADDQ.W #8,INCX
INCXX	CMP.B #1,D0
	BNE.S DECXX
	SUBQ.W #8,INCX
	BPL.S DECXX
	MOVE.W #0,INCX
DECXX	CMP.B #2,D0
	BNE.S INCYY
	ADDQ.W #8,INCY
INCYY	CMP.B #3,D0
	BNE.S DECYY
	SUBQ.W #8,INCY
	BPL.S DECYY
	MOVE.W #0,INCY
DECYY	CMP.B #4,D0
	BNE.S DEXX
	ADDQ.W #8,DOX
DEXX	CMP.B #5,D0
	BNE.S INDY
	SUBQ.W #8,DOX
	BPL.S INDY
	MOVE.W #0,DOX
INDY	CMP.B #6,D0
	BNE.S DEDY
	ADDQ.W #8,DOY
DEDY	CMP.B #7,D0
	BNE.S DEDD
	SUBQ.W #8,DOY
	BPL.S DEDD
	MOVE.W #0,DOY
DEDD	RTS
PUT_BS1	MOVE.L INCX,D0
	ADD.L D0,SUX
	MOVE.L SUX,DUX
	BSR GET_N1
	MOVE.L A1,DAT_BO1
	BSR P_SPR
	LEA DAT_BO1+4,A3
	MOVE.L DOX,D2
	REPT BOLAS
	BSR GET_NA1
	MOVE.L A1,(A3)+
	BSR P_SPR
	ADD.L D2,DUX
	ENDR
	RTS
PUT_BS2	MOVE.L INCX,D0
	ADD.L D0,SUX
	MOVE.L SUX,DUX
	BSR GET_N2
	MOVE.L A1,DAT_BO2
	BSR P_SPR
	LEA DAT_BO2+4,A3
	MOVE.L DOX,D2
	REPT BOLAS
	BSR GET_NA2
	MOVE.L A1,(A3)+
	BSR P_SPR
	ADD.L D2,DUX
	ENDR
	RTS
BORRAB1	LEA DAT_BO1,A0
	MOVE.W #BOLAS,D0
	MOVEQ #0,D7
CLR_BA	MOVEA.L (A0)+,A1
	MOVE.L D7,(A1)
	MOVE.L D7,8(A1)
	MOVE.L D7,(160*1)(A1)
	MOVE.L D7,(160*1)+8(A1)
	MOVE.L D7,(160*2)(A1)
	MOVE.L D7,(160*2)+8(A1)
	MOVE.L D7,(160*3)(A1)
	MOVE.L D7,(160*3)+8(A1)
	MOVE.L D7,(160*4)(A1)
	MOVE.L D7,(160*4)+8(A1)
	MOVE.L D7,(160*5)(A1)
	MOVE.L D7,(160*5)+8(A1)
	MOVE.L D7,(160*6)(A1)
	MOVE.L D7,(160*6)+8(A1)
	MOVE.L D7,(160*7)(A1)
	MOVE.L D7,(160*7)+8(A1)
	MOVE.L D7,(160*8)(A1)
	MOVE.L D7,(160*8)+8(A1)
	MOVE.L D7,(160*9)(A1)
	MOVE.L D7,(160*9)+8(A1)
	MOVE.L D7,(160*10)(A1)
	MOVE.L D7,(160*10)+8(A1)
	MOVE.L D7,(160*11)(A1)
	MOVE.L D7,(160*11)+8(A1)
	MOVE.L D7,(160*12)(A1)
	MOVE.L D7,(160*12)+8(A1)
	MOVE.L D7,(160*13)(A1)
	MOVE.L D7,(160*13)+8(A1)
	MOVE.L D7,(160*14)(A1)
	MOVE.L D7,(160*14)+8(A1)
	MOVE.L D7,(160*15)(A1)
	MOVE.L D7,(160*15)+8(A1)
	DBF D0,CLR_BA
	RTS
BORRAB2	LEA DAT_BO2,A0
	MOVE.W #BOLAS,D0
	MOVEQ #0,D7
CLR_BB	MOVEA.L (A0)+,A1
	MOVE.L D7,(A1)
	MOVE.L D7,8(A1)
	MOVE.L D7,(160*1)(A1)
	MOVE.L D7,(160*1)+8(A1)
	MOVE.L D7,(160*2)(A1)
	MOVE.L D7,(160*2)+8(A1)
	MOVE.L D7,(160*3)(A1)
	MOVE.L D7,(160*3)+8(A1)
	MOVE.L D7,(160*4)(A1)
	MOVE.L D7,(160*4)+8(A1)
	MOVE.L D7,(160*5)(A1)
	MOVE.L D7,(160*5)+8(A1)
	MOVE.L D7,(160*6)(A1)
	MOVE.L D7,(160*6)+8(A1)
	MOVE.L D7,(160*7)(A1)
	MOVE.L D7,(160*7)+8(A1)
	MOVE.L D7,(160*8)(A1)
	MOVE.L D7,(160*8)+8(A1)
	MOVE.L D7,(160*9)(A1)
	MOVE.L D7,(160*9)+8(A1)
	MOVE.L D7,(160*10)(A1)
	MOVE.L D7,(160*10)+8(A1)
	MOVE.L D7,(160*11)(A1)
	MOVE.L D7,(160*11)+8(A1)
	MOVE.L D7,(160*12)(A1)
	MOVE.L D7,(160*12)+8(A1)
	MOVE.L D7,(160*13)(A1)
	MOVE.L D7,(160*13)+8(A1)
	MOVE.L D7,(160*14)(A1)
	MOVE.L D7,(160*14)+8(A1)
	MOVE.L D7,(160*15)(A1)
	MOVE.L D7,(160*15)+8(A1)
	DBF D0,CLR_BB
	RTS
CLS	LEA SCREE1,A0
	MOVE.L #(32000*2/8)-1,D0
CLR_L	CLR.L (A0)+
	CLR.L (A0)+
	DBF D0,CLR_L
	RTS
PARTE	MACRO RED
	MOVE.L (160*\1)(A1),D0
	AND.L (A0)+,D0
	OR.L (A0)+,D0
	MOVE.L D0,(160*\1)(A1)
	MOVE.L (160*\1)+8(A1),D0
	AND.L (A0)+,D0
	OR.L (A0)+,D0
	MOVE.L D0,(160*\1)+8(A1)
	ENDM
PARTE0	MACRO RED
	MOVE.L (A1),D0
	AND.L (A0)+,D0
	OR.L (A0)+,D0
	MOVE.L D0,(A1)
	MOVE.L 8(A1),D0
	AND.L (A0)+,D0
	OR.L (A0)+,D0
	MOVE.L D0,8(A1)
	ENDM
P_SPR	PARTE0
	PARTE 1
	PARTE 2
	PARTE 3
	PARTE 4
	PARTE 5
	PARTE 6
	PARTE 7
	PARTE 8
	PARTE 9
	PARTE 10
	PARTE 11
	PARTE 12
	PARTE 13
	PARTE 14
	PARTE 15
	RTS
GET_N1	MOVE.W SUX,D7
	CMP.W #MAXY*8,D7
	BLT.S NOOVXA
	SUB.W #MAXY*8,D7
	MOVE.W D7,SUX
NOOVXA	LEA SINUS1+(MAXX*8),A2
	MOVE.L 0(A2,D7.W),A0
	MOVE.L 4(A2,D7.W),A1
	MOVE.W SUY,D7
	CMP.W #MAXX*8,D7
	BLT.S NOOVYA
	SUB.W #MAXX*8,D7
	MOVE.W D7,SUY
NOOVYA	LEA SINUS1(PC,D7.W),A2
	ADDA.L (A2),A1
	RTS
GET_NA1	MOVE.W DUX,D7
	CMP.W #MAXY*8,D7
	BLT.S NOINXA  
	SUB.W #MAXY*8,D7
	MOVE.W D7,DUX
NOINXA	LEA SINUS1+(MAXX*8),A2
	MOVE.L 0(A2,D7.W),A0
	MOVE.L 4(A2,D7.W),A1
	MOVE.W DUY,D7
	CMP.W #MAXX*8,D7
	BLT.S NOINYA  
	SUB.W #MAXX*8,D7
	MOVE.W D7,DUY
NOINYA	LEA SINUS1(PC,D7.W),A2
	ADDA.L (A2),A1
	RTS
SINUS1	INCBIN 'SENOS.RED'
ESINUS1
GET_N2	MOVE.W SUX,D7
	CMP.W #MAXY*8,D7
	BLT.S NOOVXB
	SUB.W #MAXY*8,D7
	MOVE.W D7,SUX
NOOVXB	LEA SINUS2+(MAXX*8),A2
	MOVE.L 0(A2,D7.W),A0
	MOVE.L 4(A2,D7.W),A1
	MOVE.W SUY,D7
	CMP.W #MAXX*8,D7
	BLT.S NOOVYB
	SUB.W #MAXX*8,D7
	MOVE.W D7,SUY
NOOVYB	LEA SINUS2(PC,D7.W),A2
	ADDA.L (A2),A1
	RTS
GET_NA2	MOVE.W DUX,D7
	CMP.W #MAXY*8,D7
	BLT.S NOINXB  
	SUB.W #MAXY*8,D7
	MOVE.W D7,DUX
NOINXB	LEA SINUS2+(MAXX*8),A2
	MOVE.L 0(A2,D7.W),A0
	MOVE.L 4(A2,D7.W),A1
	MOVE.W DUY,D7
	CMP.W #MAXX*8,D7
	BLT.S NOINYB  
	SUB.W #MAXX*8,D7
	MOVE.W D7,DUY
NOINYB	LEA SINUS2(PC,D7.W),A2
	ADDA.L (A2),A1
	RTS
SINUS2	DS.B ESINUS1-SINUS1
INCX	DS.W 1
INCY	DS.W 1
DOX	DS.W 1
DOY	DS.W 1
BALLX1	DC.W 1
DUX	DS.W 1
DUY	DS.W 1
SUX	DS.W 1
SUY	DS.W 1
LOG_SC	DS.L 1
DAT_BO1	REPT BOLAS+1
	DC.L SCREE2
	ENDR
DAT_BO2	REPT BOLAS+1
	DC.L SCREE1
	ENDR
SPR_OR	DS.W (2*4)*16*16
PRO	INCBIN 'DEMO2_LG.PI1'	

	
	
	
	
	
		
	
	