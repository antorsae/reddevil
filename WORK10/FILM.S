BAS	EQU $F8000
NM	EQU 41
LON	EQU NM*5*2 
	PEA 0
	MOVE.W #$20,-(A7)
	TRAP #1
	LEA $2000,A7
	BSR PREPWA
	BSR PREPLO
	BSR CLS
ME	MOVE.W #$25,-(A7)
	TRAP #14
	ADDQ.L #2,A7
	BSR PIX
	BSR WAVEFX
	CMP.B #$39,$FFFFFC02.W
	BNE.S ME
	PEA 0
	TRAP #1
PIX	LEA BAS,A0
	MOVEQ #0,D7
	MOVEQ #NM-1,D0
KIO	MOVE.W D7,(A0)
	MOVE.W D7,8*1(A0)
	MOVE.W D7,8*2(A0)
	MOVE.W D7,8*3(A0)
	MOVE.W D7,8*4(A0)
	MOVE.W D7,8*5(A0)
	MOVE.W D7,8*6(A0)
	MOVE.W D7,8*7(A0)
	MOVE.W D7,8*8(A0)
	MOVE.W D7,8*9(A0)
	MOVE.W D7,8*10(A0)
	MOVE.W D7,8*11(A0)
	MOVE.W D7,8*12(A0)
	MOVE.W D7,8*13(A0)
	MOVE.W D7,8*14(A0)
	MOVE.W D7,8*15(A0)
	MOVE.W D7,8*16(A0)
	MOVE.W D7,8*17(A0)
	MOVE.W D7,8*18(A0)
	MOVE.W D7,8*19(A0)
	LEA 160(A0),A0
	DBF D0,KIO
	RTS
PREPLO	LEA LK+32+(40*16*2)(PC),A0
	LEA BAS,A1
	MOVEQ #NM-1,D0
LKS	MOVE.W (A0)+,(A1)
	MOVE.W (A0)+,8*1(A1)
	MOVE.W (A0)+,8*2(A1)
	MOVE.W (A0)+,8*3(A1)
	MOVE.W #0,8*4(A1)
	LEA 160(A1),A1
	DBF D0,LKS
	LEA ROM(PC),A1
	MOVEQ #16-1,D0
ROI	BSR SAVEL
	BSR ROTAL
	DBF D0,ROI
	RTS
SAVEL	LEA BAS,A0
	MOVEQ #NM-1,D1
LKIOP	MOVE.W (A0),(A1)+
	MOVE.W 8*1(A0),(A1)+
	MOVE.W 8*2(A0),(A1)+
	MOVE.W 8*3(A0),(A1)+
	MOVE.W 8*4(A0),(A1)+
	LEA 160(A0),A0
	DBF D1,LKIOP
	RTS
ROTAL	LEA BAS,A0
	MOVEQ #NM-1,D1
KJH	MOVE.W #0,CCR
	ROXR (A0)
	ROXR 8*1(A0)
	ROXR 8*2(A0)
	ROXR 8*3(A0)
	ROXR 8*4(A0)
	LEA 160(A0),A0
	DBF D1,KJH
	RTS
PREPWA	LEA WAVES(PC),A0
	MOVEQ #0,D0
LKJHGF	ADD.L (A0),D0
	MOVE.L D0,D1
	DIVU #16,D1
	LSL.W #3,D1
	MOVE.W D1,(A0)+
	CLR.W D1
	SWAP D1
	MULU #LON,D1
	MOVE.W D1,(A0)+
	MOVE.L (A0),D1
	CMP.W #55,D1
	BNE.S LKJHGF
	MOVE.L #-1,(A0)
	RTS
WAVEFX	LEA CWA(PC),A0
	LEA BAS,A1
	LEA ROM(PC),A2
	MOVEA.L (A0),A3
	ADDQ.L #4,(A0)
	MOVEQ #NM-1,D0
FO0L	MOVE.W (A3)+,D1
	LEA 0(A1,D1.W),A4
	MOVE.W (A3)+,D1
	LEA 0(A2,D1.W),A5
	MOVE.W (A5)+,(A4)
	MOVE.W (A5)+,8*1(A4)
	MOVE.W (A5)+,8*2(A4)
	MOVE.W (A5)+,8*3(A4)
	MOVE.W (A5),8*4(A4)
	LEA 160(A1),A1
	LEA 5*2(A2),A2
	DBF D0,FO0L
	MOVE.W (A3),D0
	BPL.S FUER
	MOVE.L #WAVES,(A0)
FUER	RTS
CLS	LEA BAS,A0
	LEA BAS+32000,A1
LKIOU	CLR.L (A0)+
	CMPA.L A0,A1
	BGT.S LKIOU
	RTS
CWA	DC.L WAVES
WAVES	DC.L 250
	DS.L NM*1
	DC.L -1,-2,-2,-3,-3,-3,-4,-4,-4,-4,-5,-5,-5,-5,-5,-4,-4,-4,-4,-3,-3,-3,-2,-2,-1
	DC.L 1,2,2,3,3,3,4,4,4,4,5,5,5,5,5,4,4,4,4,3,3,3,2,2,1
	DC.L -1,-2,-2,-3,-3,-3,-4,-4,-4,-4,-5,-5,-5,-5,-5,-4,-4,-4,-4,-3,-3,-3,-2,-2,-1
	DC.L -1,-2,-2,-3,-3,-3,-4,-4,-4,-4,-5,-5,-5,-5,-5,-4,-4,-4,-4,-3,-3,-3,-2,-2,-1
	DC.L 1,2,2,3,3,3,4,4,4,4,5,5,5,5,5,4,4,4,4,3,3,3,2,2,1
	DC.L 1,2,2,3,3,3,4,4,4,4,5,5,5,5,5,4,4,4,4,3,3,3,2,2,1
	DC.L -1,-2,-2,-3,-3,-3,-4,-4,-4,-4,-5,-5,-5,-5,-5,-4,-4,-4,-4,-3,-3,-3,-2,-2,-1
	DC.L 1,2,2,3,3,3,4,4,4,4,5,5,5,5,5,4,4,4,4,3,3,3,2,2,1
	DS.L NM
	DC.L 55
LK	INCBIN 'FILM.BIN'
ROM	
	
	