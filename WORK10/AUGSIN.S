MAX	EQU 320-48
MAY	EQU 200-55-25
LINS	EQU 55
NBALLS	EQU 6
BASE 	EQU $F0000
LBAL	EQU LINS*4*5*2
LLOGO	EQU 12*2*16
	PEA 0
	MOVE.W #$20,-(A7)
	TRAP #1
	LEA $2000,A7
	BSR SETMLOG
	BSR P_BALL
	BSR SETWLOG
	BSR SETSIN
	BSR CLS
	MOVEM.L $FFFF8240.W,D0-D7
	MOVEM.L D0-D7,OLDCOL
ME	MOVE.W #$25,-(A7)
	TRAP #14
	ADDQ.L #2,A7
	MOVEM.L COLS1(PC),D0-D7
	MOVEM.L D0-D7,$FFFF8240.W
	
	BSR CHGSC
	BSR BOSPR
	BSR PLAT
	BSR CALCTR
	BSR PSPRIT
	CMP.B #$39,$FFFFFC02.W
	BNE.S ME
	MOVEM.L OLDCOL(PC),D0-D7
	MOVEM.L D0-D7,$FFFF8240.W
	CLR.L -(A7)
	TRAP #1
BOSPR	LEA BORR(PC),A0
	MOVEA.L SCREEN,A1
	MOVEQ.L #0,D1
	MOVEQ.L #0,D2
	MOVEQ.L #0,D3
	MOVEQ.L #0,D4
	MOVEQ.L #0,D5
	MOVEQ.L #0,D6
	MOVEQ.L #0,D7
	REPT NBALLS
	MOVE.W (A0)+,D0
	LEA 0(A1,D0.W),A2
	BSR BORRA
	ENDR
	RTS
BORRA	MOVEQ #0,D0
BO	MACRO LI
	MOVEM.L D0-D7,\1*160(A2)
	ENDM
BOO	MACRO LI
	BO \1
	BO (\1+1)
	BO (\1+2)
	BO (\1+3)
	BO (\1+4)
	ENDM
	BOO 0
	BOO 1*5
	BOO 2*5
	BOO 3*5
	BOO 4*5
	BOO 5*5
	BOO 6*5
	BOO 7*5
	BOO 8*5
	BOO 9*5
	BOO 10*5
	RTS
PSPRIT	LEA TRAY(PC),A0
	LEA BALL(PC),A1
	MOVEA.L SCREEN,A2
	MOVEQ #0,D0
	MOVE.W (A0)+,D0
	LEA 0(A1,D0.L),A3
	MOVE.W (A0)+,D0
	LEA 0(A2,D0.L),A4
	BSR PSPRR
	REPT NBALLS-1
	MOVEQ #0,D0
	MOVE.W (A0)+,D0
	LEA 0(A1,D0.L),A3
	MOVE.W (A0)+,D0
	LEA 0(A2,D0.L),A4
	BSR PSPR
	ENDR
	RTS
PSPRR	
MSPRI	MACRO LI
	MOVE.L 4(A3),(\1*160)+(8*0)(A4)
	MOVE.W 8(A3),(\1*160)+(8*0)+6(A4)
	MOVE.L 14(A3),(\1*160)+(8*1)(A4)
	MOVE.W 18(A3),(\1*160)+(8*1)+6(A4)
	MOVE.L 24(A3),(\1*160)+(8*2)(A4)
	MOVE.W 28(A3),(\1*160)+(8*2)+6(A4)
	MOVE.L 34(A3),(\1*160)+(8*3)(A4)
	MOVE.W 38(A3),(\1*160)+(8*3)+6(A4)
	LEA LBAL/LINS(A3),A3
	ENDM
MMSPRI	MACRO LI
	MSPRI \1
	MSPRI (\1+1)
	MSPRI (\1+2)
	MSPRI (\1+3)
	MSPRI (\1+4)
	ENDM
	MMSPRI 0*5
	MMSPRI 1*5
	MMSPRI 2*5
	MMSPRI 3*5
	MMSPRI 4*5
	MMSPRI 5*5
	MMSPRI 6*5
	MMSPRI 7*5
	MMSPRI 8*5
	MMSPRI 9*5
	MMSPRI 10*5
	RTS
	
PSPR	
PPART	MACRO LI
	MOVEM.L \1*160(A4),D0-D7
	AND.L (A3),D0
	AND.L (A3)+,D1
	OR.L (A3)+,D0
	OR.W (A3)+,D1
	AND.L (A3),D2
	AND.L (A3)+,D3
	OR.L (A3)+,D2
	OR.W (A3)+,D3
	AND.L (A3),D4
	AND.L (A3)+,D5
	OR.L (A3)+,D4
	OR.W (A3)+,D5
	AND.L (A3),D6
	AND.L (A3)+,D7
	OR.L (A3)+,D6
	OR.W (A3)+,D7
	MOVEM.L D0-D7,\1*160(A4)
	ENDM
PART	MACRO LI
	PPART \1
	PPART (\1+1)
	PPART (\1+2)
	PPART (\1+3)
	PPART (\1+4)
	ENDM
	MOVEM.L (A4),D0-D7
	AND.L (A3),D0
	AND.L (A3)+,D1
	OR.L (A3)+,D0
	OR.W (A3)+,D1
	AND.L (A3),D2
	AND.L (A3)+,D3
	OR.L (A3)+,D2
	OR.W (A3)+,D3
	AND.L (A3),D4
	AND.L (A3)+,D5
	OR.L (A3)+,D4
	OR.W (A3)+,D5
	AND.L (A3),D6
	AND.L (A3)+,D7
	OR.L (A3)+,D6
	OR.W (A3)+,D7
	MOVEM.L D0-D7,(A4)
	PPART 1
	PPART 2
	PPART 3
	PPART 4
	PART 1*5
	PART 2*5
	PART 3*5
	PART 4*5
	PART 5*5
	PART 6*5
	PART 7*5
	PART 8*5
	PART 9*5
	PART 10*5
	RTS
PLAT	LEA TRAY+2(PC),A0
	LEA BOR(PC),A1
	MOVEQ #NBALLS-1,D0
LOKJU	MOVE.W (A0),(A1)+
	ADDQ.L #4,A0
	DBF D0,LOKJU
	LEA BOR(PC),A0
	LEA BORR(PC),A1
	MOVEQ #NBALLS-1,D0
LOJU	MOVE.W (A0)+,(A1)+
	DBF D0,LOJU
	RTS
CHGSC	LEA SCREEN(PC),A0
	MOVE.L (A0),D0
	BCHG #15,D0
	MOVE.L D0,(A0)
	LSR.L #8,D0
	MOVE.B D0,$FFFF8203.W
	LSR.W #8,D0
	MOVE.B D0,$FFFF8201.W
	RTS
TRAY	REPT NBALLS
	DS.W 2
	ENDR
BOR	REPT NBALLS
	DC.W 0
	ENDR
BORR	REPT NBALLS
	DC.W 0
	ENDR
SINUSVAR
POSX	DC.W 0
POSY	DC.W 0
INCX	DC.W 1*2
INCY	DC.W 1*4
INDX	DC.W 23*2
INDY	DC.W 12*4
CALCTR	LEA TABLE(PC),A0
	LEA (MAX*2)(A0),A1
	LEA SINUSVAR(PC),A3
	LEA TRAY(PC),A4
	MOVE.L 2*2(A3),D1
	MOVE.L (A3),D0
	MOVE.W #MAY*4,D4
	ADD.L D1,D0
	CMP.W D0,D4
	BGT.S NOXX1
	SUB.W D4,D0
NOXX1	SWAP D0
	SWAP D4
	MOVE.W #MAX*2,D4
	CMP.W D0,D4
	BGT.S NOXX2
	SUB.W D4,D0
NOXX2	SWAP D4
	SWAP D0
	MOVE.L D0,(A3)
	MOVE.L 4*2(A3),D2
	REPT NBALLS
	BSR CLALC
	ENDR
	RTS
CLALC	ADD.L D2,D0
	CMP.W D0,D4
	BGT.S NOZONY
	SUB.W D4,D0
NOZONY	MOVE.W 0(A1,D0.W),D6
	MOVE.W 2(A1,D0.W),D5
	SWAP D0
	SWAP D4
	CMP.W D0,D4
	BGT.S NOZONX
	SUB.W D4,D0
NOZONX	ADD.W 0(A0,D0.W),D5 
	SWAP D0
	SWAP D4
	MOVE.W D6,(A4)+
	MOVE.W D5,(A4)+
	RTS
SETSIN	LEA TABLE(PC),A6
	LEA (A6),A0
	MOVE.W #MAX-1,D0
	BSR SETYSIN
	LEA (MAX*2)(A6),A0
	MOVE.W #MAY-1,D0
	BSR SETXSIN
	RTS
SETYSIN	MOVEQ #0,D7
	MOVE.W (A0),D7
	MULU #$A0,D7
	MOVE.W D7,(A0)+
	DBF D0,SETYSIN
	RTS
SETXSIN	MOVEQ #0,D7
	MOVE.W (A0),D7
	DIVU #16,D7
	MOVE.W D7,D6
	CLR.W D7
	SWAP D7
	MULU #LBAL,D7
	MOVE.W D7,(A0)+
	LSL.W #3,D6
	MOVE.W D6,(A0)+
	DBF D0,SETXSIN
	RTS
P_BALL	LEA AUG+(16*2)+(15*12*2)(PC),A0
	LEA BASE,A1
	BSR PBALL
	LEA BALL(PC),A1
	MOVEQ #16-1,D0
ROXL	BSR SAVEIT
	BSR ROXXIT
	DBF D0,ROXL
	RTS
SAVEIT	LEA BASE,A0
	MOVEQ #LINS-1,D1
SAVELOP	REPT 4
	MOVE.W (A0),D2
	OR.W 2(A0),D2
	OR.W 4(A0),D2
	NOT.W D2
	MOVE.W D2,(A1)+
	MOVE.W D2,(A1)+
	MOVE.L (A0),(A1)+
	MOVE.W 4(A0),(A1)+
	ADDQ.L #8,A0 
	ENDR
	LEA 160-(8*4)(A0),A0
	DBF D1,SAVELOP
	RTS
ROXXIT	LEA BASE,A0
	MOVEQ #LINS-1,D1
ROXLOP1	MOVEQ #3-1,D2	
ROXLOP0	ROXR (A0)
	ROXR 8*1(A0)
	ROXR 8*2(A0)
	ROXR 8*3(A0)
	ADDQ.L #2,A0
	DBF D2,ROXLOP0
	LEA 160-(2*3)(A0),A0
	DBF D1,ROXLOP1
	RTS
PBALL	MOVEQ #0,D7
	MOVEQ #LINS-1,D0
LKJHG	REPT 3
	MOVE.L (A0)+,(A1)+
	MOVE.W (A0)+,(A1)+
	MOVE.W D7,(A1)+
	ENDR
	MOVE.L D7,(A1)+
	MOVE.L D7,(A1)+
	LEA 160-(8*4)(A1),A1
	DBF D0,LKJHG
	RTS
CLS	LEA BASE,A0
	LEA BASE+($7D00*2),A1
JNK	CLR.L (A0)+
	CMPA.L A0,A1
	BGT.S JNK
	RTS
SETMLOG	LEA AUG+(16*2),A0
	LEA BASE,A1
	MOVEQ #12-1,D0
COLKIO	REPT 15
	MOVE.W (A0)+,(A1)
	ADDQ.L #8,A1
	ENDR
	MOVE.W #0,(A1)
	LEA 160-(15*8)(A1),A1
	DBF D0,COLKIO
	LEA LOGOR(PC),A1
	MOVEQ #16-1,D0
LKJEG	BSR SAVEL
	BSR ROTAL
	DBF D0,LKJEG
	RTS
SAVEL	LEA BASE,A0
	MOVEQ #12-1,D1
LKIO	REPT 16
	MOVE.W (A0),(A1)+
	ADDQ.L #8,A0
	ENDR
	LEA 160-(16*8)(A0),A0
	DBF D1,LKIO
	RTS
ROTAL	LEA BASE,A0
	MOVEQ #12-1,D1
	MOVE.W #0,CCR
LKIR	REPT 16
	ROXR (A0)
	ADDQ.L #8,A0
	ENDR
	LEA 160-(16*8)(A0),A0
	DBF D1,LKIR
	RTS
SETWLOG	LEA WAVETBL(PC),A0
	MOVEQ #0,D0
WAXLOK	MOVE.L (A0),D1
	CMP.L #55,D1
	BNE.S NOEND
	MOVE.L #-1,(A0)
	RTS
NOEND	ADD.L D1,D0
	MOVE.L D0,D2
	DIVU #16,D2
	LSL.W #3,D2
	MOVE.W D2,(A0)+
	CLR.W D2
	SWAP D2
	MULU #LLOGO,D2
	MOVE.W D2,(A0)+
	BRA.S WAXLOK
SCREEN	DC.L BASE
OLDCOL	DS.W 16
COLS1	DC.W $000,$110,$211,$322,$070,$070,$070,$070
	DC.W $433,$544,$655,$766,$070,$070,$070,$070
WAVETBL	DC.L 0,1,1,2,2,2,3,3,3,3,2,2,2,2,1,1,0
	DC.L 0,-1,-1,-2,-2,-2,-3,-3,-3,-3,-2,-2,-2,-2,-1,-1,0
	DC.L 55
TABLE	INCBIN 'AUGSIN.RED'
AUG	INCBIN 'AUG.BIN'
ENDP
LOGOR	EQU ENDP
BALL	EQU ENDP+(LLOGO*16)
	