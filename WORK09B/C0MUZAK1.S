BASE	EQU $F8000
	PEA 0
	MOVE.W #$20,-(A7)
	TRAP #1
	MOVEQ #1,D0
	BSR MUZAK
ME	MOVE.W #$25,-(A7)
	TRAP #14
	ADDQ.L #2,A7
	BSR ANALIZE
	BSR MUZAK+6
	BRA.S ME
ANALIZE	LEA BASE,A0
	LEA INDX(PC),A1
	LEA $FFFF8800.W,A2
	BSR F_TONE
	BSR P_TONE
	RTS
F_TONE	
MUS	MACRO CANN
	MOVEQ #0,D0
	MOVE.B #(\1+1),(A2)
	MOVE.B (A2),D0
	AND.W #8-1,D0
	LSL.W #2,D0
	MOVE.B #\1,(A2)
	MOVE.B (A2),D1
	AND.W #4-1,D1
	OR.B D1,D0
	ADD.W D0,D0
	MOVE.B #(\1+8),(A2)
	MOVE.B (A2),D1
	AND.W #16-1,D1
	LSL.W #2,D1
	MOVE.W D1,0(A1,D0.W)
	ENDM
	MUS 0
	MUS 1
	MUS 2
	
	RTS
P_TONE	MOVEQ #32-1,D0
ROWSM	LEA (A0),A2
	CMPA.L #BASE+(15*8),A0
	BNE.S MN
	LEA BASE+(100*160)-8,A0
MN	MOVE.W (A1),D1
	BEQ.S NORES
	SUBQ.W #1,D1
NORES	MOVE.W D1,(A1)+
	MOVE.W D1,D4
	MOVEQ #-1,D2
D1LOP1	MOVE.W D2,(A2)
	LEA 160(A2),A2
	DBF D1,D1LOP1
	MOVE.W #16*4-1,D3
	SUB.W D4,D3
	MOVEQ #0,D2
D3LOP1	MOVE.W D2,(A2)
	LEA 160(A2),A2
	DBF D3,D3LOP1
PAYA	ADDQ.L #8,A0
	DBF D0,ROWSM
	RTS
INDX	DS.W 32
MUZAK	INCBIN 'VAX.MUS'
	