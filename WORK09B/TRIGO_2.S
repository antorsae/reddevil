** RUTINA DE ROTACION EN 2D DE UN 
** PUNTO CON CORDENADAS POLARES..
** EN REALIDAD LA CORDENADA EL 
** ANGULO CON EL EJE Z NO ES USADO
** PERO LO DEJO PARA UNA FUTURA 
** AMPLIACION.....

** (C) 1990 RED DEVIL

LON	EQU $800*2
BASE	EQU $F8000
	PEA 0
	MOVE.W #$20,-(A7)
	TRAP #1
	LEA $2000,A7
	BSR PREPAL
ME	MOVE.W #$25,-(A7)
	TRAP #14
	LEA 2(A7),A7
	BSR ROTAL
	BRA.S ME
ROTAL	LEA CORDS(PC),A0
	LEA BASE,A1
	LEA TRIGO(PC),A2
	LEA LON(A2),A3
	LEA PROT(PC),A4
	BSR GEN
	LEA CORDS+6(PC),A0
	BSR GEN
	RTS
GEN	MOVEQ #1*2,D0
	ADD.W D0,2(A0)
	ADD.W D0,4(A0)
	AND.W #LON-1,2(A0)
	AND.W #LON-1,4(A0)
	MOVEQ #0,D0
	MOVE.W (A0),D0
	MOVE.W D0,D1
	MOVE.W 2(A0),D2
	
	MULU 0(A2,D2.W),D0
	MULU 0(A3,D2.W),D1
	
	LSR.L #8,D0
	LSR.L #8,D1
	LSR.L #7,D0
	LSR.L #7,D1
	
	MOVE.W 4(A0),D2
	
	MULU 0(A2,D2.W),D0
	MULU 0(A3,D2.W),D1
	
	LSR.L #8,D0
	LSR.L #8,D1
	LSR.L #7,D0
	LSR.L #7,D1
	
	MOVEQ #0,D3
	SUB.W (A0),D0
	SUB.W (A0),D1
	ADD.W #320/2,D0
	ADD.W #200/2,D1
	
	MULU #160,D1
	MOVE.W D0,D2
	AND.W #16-1,D2
	AND.W #$10000-15,D0
	LSR.W #1,D0
	ADD.W D2,D2
	ADD.W D1,D0
	
	MOVE.W 0(A4,D2.W),0(A1,D0.W)
	RTS
	
	
	
PREPAL	LEA PROT(PC),A0
	MOVEQ #16-1,D0
DOCVT	MOVEQ #0,D1
	BSET D0,D1
	MOVE.W D1,(A0)+
	DBF D0,DOCVT
	LEA TRIGO(PC),A0
	MOVE.W #(LON*2*2)-1,D0
	MOVE.W #$8000,D1
DOADD	ADD.W D1,(A0)+
	DBF D0,DOADD
	RTS
PROT	DS.W 16
CORDS	DC.W 80,(LON/8),(LON/2)
	DC.W 100,(LON/8),(LON/2)
	
TRIGO	INCBIN 'SIN_COS.RED'
	